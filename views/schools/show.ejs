<%- include("../partials/header") %>

<div class="row">
  <!-- Left Column -->
  <div class="col-md-9 col-sm-12">

    <!-- Main Information -->
    <div class="card">
      <div class="card-body">
        <h3 style="text-align: center;">School</h3>
        <hr>
        <img class="card-img-top" src="/<%= school.image %>" alt="No Image">
        <hr>
        <p class="h4"><%= school.name %></p>
        <p class="h4"><%= school.country %></p>
        
        <!-- Favorite Button -->
        <form action="/schools/<%= school._id %>/favorite" method="POST">
          <% if (isFavoriteUser) { %>
          <p>This school is your favorite</p>
          <button class="btn btn-sm btn-secondary">
            <i class="fas fa-thumbs-up"></i> Unfavorite
          </button>
          <% } else if (!isFavoriteUser) { %>
          <p>This school is not your favorite</p>
          <button class="btn btn-sm btn-primary">
            <i class="fas fa-thumbs-up"></i> Favorite
          </button>
          <% } %>
        </form>
        <!-- Favorite Button End -->

        <!-- Favorite Modal -->
        <%- include("../partials/modal/favoriteUsers") %>
        <!-- Favorite Modal End-->

        <p class="h4">Rating</p>
        <% if (!school.averageRating) { %>
        <p>
          No Rating Yet
        </p>
        <% } else { %>
        <p>
          <span>
            <i class="fas fa-star <% if (school.averageRating >= 1.0) { %> checked <% } %>"></i>
            <i class="fas fa-star <% if (school.averageRating >= 1.5) { %> checked <% } %>"></i>
            <i class="fas fa-star <% if (school.averageRating >= 2.5) { %> checked <% } %>"></i>
            <i class="fas fa-star <% if (school.averageRating >= 3.5) { %> checked <% } %>"></i>
            <i class="fas fa-star <% if (school.averageRating >= 4.5) { %> checked <% } %>"></i>
          </span>
          (<%= school.averageRating.toFixed(2) %>)
        </p>
        <% } %>

        <% if (currentUser && currentUser._id.equals(school.user)) { %>
        <a
          class="btn btn-warning"
          href="/schools/<%= school._id %>/edit"
          role="button"
        >
          <i class="fas fa-edit"></i> EDIT
        </a>

        <!-- Delete School Modal-->
        <%- include("../partials/modal/deleteSchool") %>
        <!-- Delete School Modal Trigger End -->

        <% } %>
      </div>
    </div>
    <!-- Main Information End -->
    
    <!-- New Review -->
    <div class="card">
      <div class="card-body">

        <!-- New Review Toggle -->
        <div class="clearfix mb-2">
          <a
            class="btn btn-success float-right"
            role="button"
            data-toggle="collapse"
            href="#collapseNewReview"
            aria-expanded="false"
            aria-controls="collapseNewReview"
          >
          <i class="fas fa-plus"></i> Add new review
          </a>
          <h4>
            <strong>
              Reviews (total: <%= school.reviews.length %>)
            </strong>
          </h4>
        </div>
        <!-- New Review Toggle End -->

        <!-- New Review Form -->
        <div class="collapse" id="collapseNewReview">
          <div class="card" style="border-left: 5px solid #00C851;">
            <div class="card-body">
              <% if(!currentUser) { %>
              <h5 class="card-title">
                You need to login before you review. 
                <a href="/login">Click here</a>
                to go to the login page.
              </h5>
              <% } %>
              <% if(isUserHasReview) { %>
              <h5 class="card-title">
                You have already written review to this school.
              </h5>
              <% } %>
              <% if(currentUser && !isUserHasReview) { %>
              <h4 class="card-title">Write your review</h4>
              <form
                action="/schools/<%= school._id %>/reviews"
                method="POST"
              >
                <div class="form-group">
                  <label for="title">Title</label>
                  <input
                    type="text"
                    class="form-control"
                    id="title"
                    name="title"
                    placeholder="I really enjoy studying with classmate!"
                    value="<%= typeof review != 'undefined' ? review.title : '' %>"
                  >
                </div>

                <div class="form-group">
                  <label for="degree">Degree</label>
                  <select name="degree" id="degree" class="custom-select">
                    <option value="Certificate (1 year)" selected>Certificate (1 year)</option>
                    <option value="Diploma (2 years)">Diploma (2 years)</option>
                    <option value="Advanced Diploma (3 years)">Advanced Diploma (3 years)</option>
                    <option value="Bachelor (4 years)">Bachelor (4 years)</option>
                    <option value="Master">Master</option>
                    <option value="Doctor">Doctor</option>
                    <option value="Other">Other</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="rating">Rating</label>
                  <fieldset class="starability-basic form-group" id="rating">
                    <div>
                      <input
                        type="radio"
                        id="first-rate5"
                        name="rating"
                        value="5"
                        checked
                      />
                      <label for="first-rate5" title="Amazing">
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star checked"></i>
                      </label>
                    </div>
                    <div>
                      <input
                        type="radio"
                        id="first-rate4"
                        name="rating"
                        value="4"
                      />
                      <label for="first-rate4" title="Very good">
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star"></i>
                      </label>
                    </div>
                    <div>
                      <input
                        type="radio"
                        id="first-rate3"
                        name="rating"
                        value="3"
                      />
                      <label for="first-rate3" title="Average">
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                      </label>
                    </div>
                    <div>
                      <input
                        type="radio"
                        id="first-rate2"
                        name="rating"
                        value="2"
                      />
                      <label for="first-rate2" title="Not good">
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                      </label>
                    </div>
                    <div>
                      <input
                        type="radio"
                        id="first-rate1"
                        name="rating"
                        value="1"
                      />
                      <label for="first-rate1" title="Terrible">
                        <i class="fas fa-star checked"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                      </label>
                    </div>
                  </fieldset>
                </div>
        
                <div class="form-group">
                  <label for="description">Description</label>
                  <textarea
                    type="text"
                    class="form-control"
                    id="description"
                    name="description"
                    rows="3"
                    placeholder="I highly recommend you check this college"
                  ><%= typeof review != 'undefined' ? review.description : '' %></textarea>
                </div>

                <div class="form-group">
                  <button class="btn btn-success btn-sm">
                    SUBMIT
                  </button>
                </div>
              </form>
              <% } %>
            </div>
          </div>
        </div>
        <!-- New Review Form End -->

        <hr>

        <!-- Exists Reviews -->
        <div class="row">
          <div class="col-md-12">
            <% reviews.forEach(review => { %>
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col-6 col-md-4">
                    <img src="/<%= review.user.image %>" class="card-img-top" alt="No Image">
                    <p><%= review.user.name %></p>
                    <% if (currentUser && currentUser._id.equals(review.user._id)) { %>

                    <!-- Edit Review Toggle -->
                    <a
                      class="btn btn-warning"
                      role="button"
                      data-toggle="collapse"
                      href="#collapseEditReview<%= review.user._id %>"
                      aria-expanded="false"
                      aria-controls="collapseEditReview"
                    >
                      <i class="fas fa-edit"></i> Edit
                    </a>
                    <!-- Edit Review Toggle End -->

                    <!-- Delete Review Modal Trigger -->
                    <a
                      href="#"
                      class="card-link"
                      data-toggle="modal"
                      data-target="#deleteReview"
                    >
                      <button class="btn btn-danger">
                        <i class="fas fa-trash-alt"></i> DELETE
                      </button>
                    </a>
                    <%- include("../partials/modal/deleteReview") %>
                    <!-- Delete Review Modal Trigger End -->
              
                    <!-- Delete Review Modal -->
                    <div
                      class="modal fade"
                      id="deleteReview"
                      tabindex="-1"
                      role="dialog"
                      aria-labelledby="deleteReview"
                      aria-hidden="true"
                    >
                      <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">
                              <i class="fas fa-exclamation-triangle"></i>
                              Warning!
                            </h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">
                            Do you really want to delete this review?
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                              <i class="fas fa-window-close"></i> Close
                            </button>
                            <form action="/schools/<%= school._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
                              <button class="btn btn-danger">
                                <i class="fas fa-trash-alt"></i> Delete
                              </button>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Delete Review Modal End -->

                    <% } %>
                  </div>
                  <div class="col-12 col-md-8">
                    <h3><%= review.title %></h3>
                    <span>
                      <i class="fas fa-star <% if (review.rating >= 1.0) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (review.rating >= 1.5) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (review.rating >= 2.5) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (review.rating >= 3.5) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (review.rating >= 4.5) { %> checked <% } %>"></i>
                    </span>
                    <p><%= moment(review.createdAt).format('YYYY-MM-DD') %></p>
                    <p><%= review.description %></p>
                  </div>
                </div>

                <!-- Edit Review Form -->
                <div class="collapse" id="collapseEditReview<%= review.user._id %>">
                  <div class="card" style="border-left: 5px solid #ffbb33;">
                    <div class="card-body">
                      <h4 class="card-title">Edit your review</h4>
                      <form
                        action="/schools/<%= school._id %>/reviews/<%= review._id %>?_method=PUT"
                        method="POST"
                      >
                        <div class="form-group">
                          <label for="title">Title</label>
                          <input
                            type="text"
                            class="form-control"
                            id="title"
                            name="title"
                            placeholder="I really enjoy studying with classmate!"
                            value="<%= typeof review != 'undefined' ? review.title : '' %>"
                          >
                        </div>

                        <div class="form-group">
                          <label for="degree">Degree</label>
                          <select name="degree" id="degree" class="custom-select">
                            <option value="Certificate (1 year)" selected>Certificate (1 year)</option>
                            <option value="Diploma (2 years)">Diploma (2 years)</option>
                            <option value="Advanced Diploma (3 years)">Advanced Diploma (3 years)</option>
                            <option value="Bachelor (4 years)">Bachelor (4 years)</option>
                            <option value="Master">Master</option>
                            <option value="Doctor">Doctor</option>
                            <option value="Other">Other</option>
                          </select>
                        </div>

                        <div class="form-group">
                          <label for="rating">Rating</label>
                          <fieldset class="starability-basic form-group" id="rating">
                            <div>
                              <input
                                type="radio"
                                id="first-rate5"
                                name="rating"
                                value="5"
                                <% if (review.rating === 5) { %>
                                  checked
                                <% } %>
                              />
                              <label for="first-rate5" title="Amazing">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                              </label>
                            </div>
                            <div>
                              <input
                                type="radio"
                                id="first-rate4"
                                name="rating"
                                value="4"
                                <% if (review.rating === 4) { %>
                                  checked
                                <% } %>
                              />
                              <label for="first-rate4" title="Very good">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="far fa-star"></i>
                              </label>
                            </div>
                            <div>
                              <input
                                type="radio"
                                id="first-rate3"
                                name="rating"
                                value="3"
                                <% if (review.rating === 3) { %>
                                  checked
                                <% } %>
                              />
                              <label for="first-rate3" title="Average">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="far fa-star"></i>
                                <i class="far fa-star"></i>
                              </label>
                            </div>
                            <div>
                              <input
                                type="radio"
                                id="first-rate2"
                                name="rating"
                                value="2"
                                <% if (review.rating === 2) { %>
                                  checked
                                <% } %>
                              />
                              <label for="first-rate2" title="Not good">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="far fa-star"></i>
                                <i class="far fa-star"></i>
                                <i class="far fa-star"></i>
                              </label>
                            </div>
                            <div>
                              <input
                                type="radio"
                                id="first-rate1"
                                name="rating"
                                value="1"
                                <% if (review.rating === 1) { %>
                                  checked
                                <% } %>
                              />
                              <label for="first-rate1" title="Terrible">
                                <i class="fas fa-star"></i>
                                <i class="far fa-star"></i>
                                <i class="far fa-star"></i>
                                <i class="far fa-star"></i>
                                <i class="far fa-star"></i>
                              </label>
                            </div>
                          </fieldset>
                        </div>

                        <div class="form-group">
                          <label for="description">Description</label>
                          <textarea
                            type="text"
                            class="form-control"
                            id="description"
                            name="description"
                            rows="3"
                            placeholder="I highly recommend you check this college"
                          ><%= typeof review != 'undefined' ? review.description : '' %></textarea>
                        </div>

                        <div class="form-group">
                          <button class="btn btn-success btn-sm">
                            SUBMIT
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
                <!-- Edit Review Form End -->

              </div>
            </div>
            <% }) %>
            <a href="#">Check All Reviews</a>
          </div>
        </div>
        <!-- Exists Reviews End -->

      </div>
    </div>
    <!-- New Review End-->

    <a href="/schools">Go back to Schools Page</a>
  </div>
  <!-- Left Column End -->

  <!-- Right Column -->
  <div class="col-md-3 col-sm-12">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title">Popular Schools</h5>
        <hr>
        <a href="#" class="card-link">
          <div class="row">
            <% popularSchools.forEach(popularSchool => { %>
            <div class="col-md-12">
              <div class="card">
                <img src="/<%= popularSchool.image %>" class="card-img-top" alt="No Image">
                <div class="card-body">
                  <p class="card-title">
                    <%= popularSchool.name %>
                  </p>
                  <% if (!popularSchool.averageRating) { %>
                  <p>
                    No Rating Yet
                  </p>
                  <% } else { %>
                  <p>
                    <span>
                      <i class="fas fa-star <% if (popularSchool.averageRating>= 1.0) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (popularSchool.averageRating>= 1.5) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (popularSchool.averageRating>= 2.5) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (popularSchool.averageRating>= 3.5) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (popularSchool.averageRating>= 4.5) { %> checked <% } %>"></i>
                    </span>
                  </p>
                  <% } %>
                  <span class="badge badge-secondary mb-2">
                    <i class="fas fa-thumbs-up"></i> Like: <%= popularSchool.likes.length %>
                  </span>
                  <span class="badge badge-secondary mb-2">
                    <i class="fas fa-comment-dots"></i> Review: <%= popularSchool.reviews.length %>
                  </span>
                </div>
              </div>
            </div>
            <% }) %>
          </div>
        </a>
      </div>
    </div>

    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title">New Arrivai Schools</h5>
        <hr>
        <a href="#" class="card-link">
          <div class="row">
            <div class="col-md-12">
              <% newArrivalSchools.forEach(newArrivalSchool => { %>
              <div class="card">
                <img src="/<%= newArrivalSchool.image %>" class="card-img-top" alt="No Image">
                <div class="card-body">
                  <p class="card-title">
                    <%= newArrivalSchool.name %>
                  </p>
                  <% if (!newArrivalSchool.averageRating) { %>
                  <p>
                    No Rating Yet
                  </p>
                  <% } else { %>
                  <p>
                    <span>
                      <i class="fas fa-star <% if (newArrivalSchool.averageRating>= 1.0) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (newArrivalSchool.averageRating>= 1.5) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (newArrivalSchool.averageRating>= 2.5) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (newArrivalSchool.averageRating>= 3.5) { %> checked <% } %>"></i>
                      <i class="fas fa-star <% if (newArrivalSchool.averageRating>= 4.5) { %> checked <% } %>"></i>
                    </span>
                  </p>
                  <% } %>
                  <span class="badge badge-secondary mb-2">
                    <i class="fas fa-thumbs-up"></i> Like: <%= newArrivalSchool.likes.length %>
                  </span>
                  <span class="badge badge-secondary mb-2">
                    <i class="fas fa-comment-dots"></i> Review: <%= newArrivalSchool.reviews.length %>
                  </span>
                </div>
              </div>
              <% }) %>
            </div>
          </div>
        </a>
      </div>
    </div>

    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title">Schools in the same country</h5>
      </div>
    </div>
  </div>
  <!-- Right Column End -->
</div>

<%- include("../partials/footer") %>