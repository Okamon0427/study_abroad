<%- include("../partials/header") %>

<div class="container mt-4">
  <div class="row">
    <div class="col-md-12 col-lg-9">

      <!-- Main Information -->
      <div class="card mb-4">
        <div class="card-body">
          <h3 class="text-center"><%= school.name %></h3>

          <div class="row mb-4">
            <div class="col-12 col-md-6 col-lg-4 mx-auto">
              <img style="width: 100%; max-width: 300px;" src="<%= school.image && school.image.url %>" alt="No Image">
            </div>
            <div class="col-12 col-md-6 col-lg-8 pt-2 pb-2">
              <p class="h5">Overview</p>
            </div>
          </div>

          <div class="row">
            <div class="col-12 col-md-6 mx-auto pt-2 pb-2"> 
              <!-- Average Rating -->
              <p class="h5">
                Rating: 
                <% if (!school.averageRating) { %>
                <span class="font-italic">No Rating Yet</span>
                <% } else { %>
                <span>
                  <i class="fas fa-star <% if (school.averageRating >= 1.0) { %> checked <% } %>"></i>
                  <i class="fas fa-star <% if (school.averageRating >= 1.5) { %> checked <% } %>"></i>
                  <i class="fas fa-star <% if (school.averageRating >= 2.5) { %> checked <% } %>"></i>
                  <i class="fas fa-star <% if (school.averageRating >= 3.5) { %> checked <% } %>"></i>
                  <i class="fas fa-star <% if (school.averageRating >= 4.5) { %> checked <% } %>"></i>
                </span>
                <span>
                  (<%= school.averageRating.toFixed(2) %>)
                </span>
                <% } %>
              </p>

              <div class="mt-4 mb-4">
                <!-- Favorite -->
                <form class="mb-2" action="/schools/<%= school.slug %>/favorite" method="POST">
                  <% if (isFavoriteUser) { %>
                  <button class="btn btn-sm mr-2 btn-secondary">
                    <i class="fas fa-thumbs-up"></i> Unfavorite
                  </button>
                  <% } else if (!isFavoriteUser) { %>
                  <button class="btn btn-sm mr-2 btn-primary">
                    <i class="fas fa-thumbs-up"></i> Favorite
                  </button>
                  <% } %>
                  <%- include("../partials/modal/favoriteUsers") %>
                </form>

                <!-- School Edit -->
                <% if (currentUser && currentUser._id.equals(school.user) || (currentUser && currentUser.isAdmin)) { %>
                <a
                  class="btn btn-sm btn-warning mr-2"
                  href="/schools/<%= school.slug %>/edit"
                  role="button"
                >
                  <i class="fas fa-edit"></i> EDIT
                </a>

                <!-- Delete School Modal-->
                <%- include("../partials/modal/deleteSchool") %>

                <% } %>
              </div>
              <p><b>Address: </b><%= school.location.formattedAddress %></p>
              <h5>
                <span class="badge badge-pill badge-info">
                  <%= school.location.country %>
                </span>
                <span class="badge badge-pill badge-secondary">
                  <%= school.location.city %>
                </span>
              </h5>
            </div>
            <!-- Show Map -->
            <div class="col-12 col-md-6 mx-auto mb-4">
              <div id='map' style='width: 250px; height: 250px;'></div>
              <script>
                const lat = <%= school.location.coordinates[0] %>;
                const lng = <%= school.location.coordinates[1] %>;
                const key = 'pk.eyJ1IjoiaGVtaGVtIiwiYSI6ImNrZWRpdHByZzAza2syeW83cDk2ZHh5dTYifQ.-CbpUnMncBCHzPLwheZUJA';
                mapboxgl.accessToken = key;
                const map = new mapboxgl.Map({
                  container: 'map',
                  style: 'mapbox://styles/mapbox/streets-v11',
                  zoom: 13,
                  center: [lat, lng]
                });
                const marker = new mapboxgl.Marker()
                .setLngLat([lat, lng])
                .addTo(map);
              </script>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Reviews -->
      <div class="mb-4">
        <%- include("./schoolPartials/newReview") %>
        <%- include("./schoolPartials/existsReview") %>
      </div>

    </div>

    <div class="col-md-12 col-lg-3">
    <%- include("./schoolPartials/popular") %>
    <%- include("./schoolPartials/newArrival") %>
    </div>

  </div>
</div>

<%- include("../partials/footer") %>